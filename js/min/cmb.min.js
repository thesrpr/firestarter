/**
 * Controls the behaviours of custom metabox fields.
 *
 * @author Andrew Norcross
 * @author Jared Atchison
 * @author Bill Erickson
 * @author Justin Sternberg
 * @see    https://github.com/jaredatch/Custom-Metaboxes-and-Fields-for-WordPress
 *//*jslint browser: true, devel: true, indent: 4, maxerr: 50, sub: true *//*global jQuery, tb_show, tb_remove *//**
 * Custom jQuery for Custom Metaboxes and Fields
 */jQuery(document).ready(function(e){"use strict";function n(t,n){var r=t.val();if(r.length<6)return;if(n==="paste"||n.which<=90&&n.which>=48||n.which>=96&&n.which<=111||n.which==8||n.which==9||n.which==187||n.which==190){var i=t.attr("id"),s=t.parents(".cmb_metabox tr td");e(".cmb-spinner",s).show();e(".embed_wrap",s).html("");setTimeout(function(){e(".cmb_oembed:focus").val()==r&&e.ajax({type:"post",dataType:"json",url:window.ajaxurl,data:{action:"cmb_oembed_handler",oembed_url:r,field_id:i,post_id:window.cmb_ajax_data.post_id,cmb_ajax_nonce:window.cmb_ajax_data.ajax_nonce},success:function(t){if(typeof t.id!="undefined"){e(".cmb-spinner",s).hide();e(".embed_wrap",s).html(t.result)}}})},500)}}var t;e(".cmb_timepicker").each(function(){e("#"+jQuery(this).attr("id")).timePicker({startTime:"07:00",endTime:"22:00",show24Hours:!1,separator:":",step:30})});e(".cmb_datepicker").each(function(){e("#"+jQuery(this).attr("id")).datepicker()});e("#ui-datepicker-div").wrap('<div class="cmb_element" />');typeof jQuery.wp=="object"&&typeof jQuery.wp.wpColorPicker=="function"?e("input:text.cmb_colorpicker").wpColorPicker():e("input:text.cmb_colorpicker").each(function(t){e(this).after('<div id="picker-'+t+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');e("#picker-"+t).hide().farbtastic(e(this))}).focus(function(){e(this).next().show()}).blur(function(){e(this).next().hide()});e(".cmb_upload_file").change(function(){t=e(this).attr("name");e("#"+t+"_id").val("")});e(".cmb_upload_button").live("click",function(){var n;t=e(this).prev("input").attr("name");n="Use as "+e("label[for="+t+"]").text();tb_show("","media-upload.php?post_id="+e("#post_ID").val()+"&type=file&cmb_force_send=true&cmb_send_label="+n+"&TB_iframe=true");return!1});e(".cmb_remove_file_button").live("click",function(){t=e(this).attr("rel");e("input#"+t).val("");e("input#"+t+"_id").val("");e(this).parent().remove();return!1});window.original_send_to_editor=window.send_to_editor;window.send_to_editor=function(n){var r,i,s,o,u,a,f,l=!0;if(t){if(e(n).html(n).find("img").length>0){r=e(n).html(n).find("img").attr("src");i=e(n).html(n).find("img").attr("class");s=i.split(" ");o=s[s.length-1];o=o.replace("wp-image-","")}else{u=n.split("'");r=u[1];a=u[2];a=a.replace(">","");a=a.replace("</a>","");o=""}f=/(jpe?g|png|gif|ico)$/gi;if(r.match(f))l='<div class="img_status"><img src="'+r+'" alt="" /><a href="#" class="cmb_remove_file_button" rel="'+t+'">Remove Image</a></div>';else{n='<a href="'+r+'" target="_blank" rel="external">View File</a>';l='<div class="no_image"><span class="file_link">'+n+'</span>&nbsp;&nbsp;&nbsp;<a href="#" class="cmb_remove_file_button" rel="'+t+'">Remove</a></div>'}e("#"+t).val(r);e("#"+t+"_id").val(o);e("#"+t).siblings(".cmb_media_status").slideDown().html(l);tb_remove()}else window.original_send_to_editor(n);t=""};e(".cmb_oembed").bind("paste",function(t){var r=e(this);setTimeout(function(){n(r,"paste")},100)}).blur(function(){setTimeout(function(){e(".postbox table.cmb_metabox .cmb-spinner").hide()},2e3)});e(".cmb_metabox").on("keyup",".cmb_oembed",function(t){n(e(this),t)})});